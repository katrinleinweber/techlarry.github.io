<!doctype html>
<html class="no-js" lang="en">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?fdc936c9f5a3b72177541183cdeb8cb3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Python数据结构与算法 - techlarry
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="techlarry" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:larryim.cc ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="about.html">About</a></li>
        
        <li id=""><a target="_self" href="category.html">Category</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; techlarry</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        
        <li><a target="_self" href="about.html">About</a></li>
        
        <li><a target="_self" href="category.html">Category</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="Leetcode.html">Leetcode</a></li>
        
            <li><a href="Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html">Python数据结构与算法</a></li>
        
            <li><a href="Python%E7%89%B9%E6%80%A7.html">Python特性</a></li>
        
            <li><a href="%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html">机器学习</a></li>
        
            <li><a href="Python%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E4%B8%89%E7%BB%B4%E5%8F%AF%E8%A7%86%E5%8C%96.html">Python科学计算三维可视化</a></li>
        
            <li><a href="English.html">English</a></li>
        
            <li><a href="%20%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA.html"> 理解计算机</a></li>
        
            <li><a href="Deep%20Learning.html">Deep Learning</a></li>
        
            <li><a href="Latex.html">Latex</a></li>
        
            <li><a href="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html">操作系统</a></li>
        
            <li><a href="Linux%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html">Linux 系统编程</a></li>
        
            <li><a href="%E6%95%B0%E6%8D%AE%E5%BA%93.html">数据库</a></li>
        
            <li><a href="Tensorflow.html">Tensorflow</a></li>
        
            <li><a href="%E5%B7%A5%E4%BD%9C%E4%B8%8E%E5%AD%A6%E4%B9%A0.html">工作与学习</a></li>
        
            <li><a href="Data%20Science.html">Data Science</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="greedy_algorithm_a_scheduling_problem.html">
                
                  <h1>Greedy algorithm (2): A Scheduling Application</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p><strong>Problem Statement</strong>: You want to schedule jobs (processes) on a processor. Each job has properties:</p>

<ul>
<li>weight \(w_j\) (“priority”) </li>
<li>length \(l_j\)</li>
</ul>

<p>The <code>completion time</code> \(C_j\) of job \(j\) is Sum of job lengths up to and including job \(j\).</p>

<p>The goal is to <strong>Minimize weighted sum of completion times</strong>, i.e.</p>

<p>\[\sum_{j=1}^n w_j*C_j\]</p>

<h2 id="toc_0">Algorithm</h2>

<p>Order jobs by decreasing value of \(\frac{w_j}{l_j}\), i.e. jobs have larger weight and shorter length execute earlier.</p>

<h3 id="toc_1">Greedy Exchange</h3>

<p><code>Greedy Exchange</code> is one of the techniques used in proving the correctness of greedy algorithms. The idea of a greedy exchange proof is to morph a solution produced by an optimal algorithm into the solution produced by your greedy algorithm. This shows that any optimal solution is no better than the greedy solution, which proves that greedy does in fact return an optimal solution.</p>

<h3 id="toc_2">Proof</h3>

<h4 id="toc_3">Step1: label algorithm&#39;s solution and an optimal solution</h4>

<p>Let \(\sigma\) be greedy schedule, and \(\sigma^*\) be optimal schedule. </p>

<h4 id="toc_4">Step2: Compare greedy with optimal</h4>

<p>Greedy schedule \(\sigma\) is just \(1,2,3,...,n\). And if optimal schedule \(\sigma^* \ne \sigma \), then \(\exists\) consecutive jobs \(i,j\), which \(i&gt;j\).</p>

<h4 id="toc_5">Step3: Exchange</h4>

<p>Suppose we exchange order of \(i,j\) in \(\sigma\):</p>

<ul>
<li>the cost of exchange \(w_jl_j\)</li>
<li>the benefit of exchange is \(w_jl_i\)</li>
</ul>

<p>Note: <br/>
\[i &gt;j \rightarrow w_i/l_i \le wj/lj \rightarrow w_il_j \le w_jl_i \]<br/>
Exchanging \(i,j\) in \(\sigma^*\) has net benefit of \(w_jl_i-w_il_j \ge0\).</p>

<p>\(\rightarrow\) After at most \(C_n^2\) such exchanges, \(\sigma^*\) can transform into \(\sigma\)<br/>
\(\rightarrow \sigma \) at least as good as \(\sigma^*\)<br/>
 \(\rightarrow \) Greedy is optimal.</p>

<h2 id="toc_6">Implemenation</h2>

<pre><code class="language-python">import numpy as np
import unittest

class JobSchedule:
    &quot;&quot;&quot;
    greedy algorithm that schedules jobs in decreasing order of ratio (weight/length)
    &quot;&quot;&quot;
    def __init__(self):
        self.job_num = 0 # the number of jobs
        self.job_weight = []
        self.job_length = []
        self.schedule_time = None
        self.order = None # the ordering of jobs

    def buildjobs(self, textfile):
        &quot;&quot;&quot;
        build jobs from a text file

        The file describes a set of jobs with positive and integral weights and lengths.
        It has the format
        [number_of_jobs]
        [job_1_weight] [job_1_length]

        &quot;&quot;&quot;
        count = 0
        with open(textfile) as infile:
            for line in infile.readlines():
                line = line.strip(&#39;\n&#39;)
                if count == 0:
                    self.job_num = int(line)
                else:
                    job_weight, job_length = (int(num) for num in line.split())
                    self.job_weight.append(job_weight)
                    self.job_length.append(job_length)
                count += 1

        if count-1 != self.job_num:
            raise ValueError

    def scheduling(self):
        &quot;&quot;&quot;
        return the sum of weighted completion times of the resulting schedule
        &quot;&quot;&quot;
        # ratios of weight and length for every job
        ratios = [self.job_weight[i]/self.job_length[i] for i in range(self.job_num)]
        self.order = np.lexsort((self.job_length, ratios))
        self.order=self.order[::-1]
        print([ (self.job_weight[i], self.job_length[i],self.job_weight[i]/self.job_length[i]) for i in self.order])
        # calculating the sum of weighted completion times of the resulting schedule
        count = 0
        job_length = 0
        for job_ind in self.order:
            job_length = job_length + self.job_length[job_ind]
            count += self.job_weight[job_ind]*job_length
        self.schedule_time = count
        return self.schedule_time


class TestJobSchedule(unittest.TestCase):

    def testcase1(self):
        jobs_to_schedule = JobSchedule()
        jobs_to_schedule.buildjobs(&#39;testcase1.txt&#39;)
        assert jobs_to_schedule.scheduling() == 16

    def testcase2(self):
        jobs_to_schedule = JobSchedule()
        jobs_to_schedule.buildjobs(&#39;testcase2.txt&#39;)
        assert jobs_to_schedule.scheduling() == 67247


if __name__ == &quot;__main__&quot;:
    unittest.main()
</code></pre>

<h2 id="toc_7">References</h2>

<ol>
<li><a href="http://www.cs.cornell.edu/courses/cs482/2003su/handouts/greedy_exchange.pdf">Greedy exchange</a></li>
<li><a href="https://www.coursera.org/learn/algorithms-greedy/">Algorithms Specialization</a></li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/8/1</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Greedy.html'>Greedy</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="greedy_algorithm_introduction.html">
                
                  <h1>Greedy algorithm (1): Introduction</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<ul>
<li>
<a href="#toc_0">Definition</a>
</li>
<li>
<a href="#toc_1">Contrast with Divide &amp; Conquer</a>
</li>
</ul>
</li>
<li>
<a href="#toc_2">Examples</a>
<ul>
<li>
<a href="#toc_3">The Optimal Caching Algorithm</a>
</li>
<li>
<a href="#toc_4">A Scheduling Problem</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">Reference</a>


<h3 id="toc_0">Definition</h3>

<p>A <code>greedy algorithm</code> always makes the choice that looks best at the moment. That is, it makes a locally optimal choice in the hope that this choice will lead to a globally optimal solution. (Cormen et al., 2009)</p>

<h3 id="toc_1">Contrast with Divide &amp; Conquer</h3>

<ol>
<li>Easy to propose multiple greedy algorithms for many problems. </li>
<li>Easy running time analysis. (Contrast with Master method etc.)</li>
<li>Hard to establish correctness.
(Contrast with straightforward inductive correctness proofs.)</li>
</ol>

<p><strong>DANGER: Most greedy algorithms are NOT correct. (Even if your intuition says otherwise!)</strong></p>

<h2 id="toc_2">Examples</h2>

<h3 id="toc_3">The Optimal Caching Algorithm</h3>

<p>Theorem: [Bélády&#39;s 1960s] <code>Farthest-in-Future</code> is the optimal algorithm that minimizes the number of cache misses.</p>

<p><code>Bélády&#39;s Algorithm</code>:</p>

<p>When \(d_i\) is requested but not in the cache,<br/>
evict the cache item that will next be used farthest into the future.</p>

<h3 id="toc_4">A Scheduling Problem</h3>

<p>Assume: Each job has a:</p>

<ul>
<li>weight \(w_j\) (“priority”) </li>
<li>length \(l_j\)</li>
</ul>

<p>The completion time \(C_j\) of job \(j\) = Sum of job lengths up to and including \(j\).</p>

<p>Goal: Minimize the weighted sum of completion times: \(\min \sum ^n_j= w_jC_j\)</p>

<h2 id="toc_5">Reference</h2>

<ol>
<li>Cormen, Leiserson, Rivest, and Stein. 2009. Introduction to Algorithms (3rd edition)</li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/7/31</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Greedy.html'>Greedy</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="Hash_Table_4_Universal_Hashing.html">
                
                  <h1>Hash Table (4): Universal Hashing</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>Let \(H\) be a finite collection of hash functions that map a given universe \(U\) of keys into the range \(\{0,1,...,m-1\}\). Such a collection is said to be <code>universal</code> if for each pair of distinct keys \(k,l \in U\), the number of <code>hash function</code> \(h \in H\) for which \(h(k) = h(l)\) is at most \(\frac{|H|}{m}\), i.e.</p>

<p>\[ \forall k,l \in U, k\ne l: \Pr_{h\in H }[h(x)=h(y)]\le \frac{1}{m}  \]</p>

<h2 id="toc_0">Why Universal Hashing?</h2>

<p>Some malicious adversary might chooses the keys which all hash to the same slot, yielding an average retrieval time of \(\Theta(n)\). Instead of fixed hash functions, randomly chosen hash functions can yield good performance on average.</p>

<h2 id="toc_1">Designing a universal class of hash functions</h2>

<p>In short, you can generate family of hash functions using following simple equation:</p>

<pre><code class="language-python">h(x,a,b) = ((ax+b) mod p) mod m
</code></pre>

<p>\(x\) is key you want to hash<br/>
\(a\) is any number you can choose between \(1\) to \(p-1\) inclusive.<br/>
\(b\) is any number you can choose between \(0\) to \(p-1\) inclusive.<br/>
\(p\) is a prime number that is greater than max possible value of \(x\)<br/>
\(m\) is a max possible value you want for hash code + 1<br/>
By selecting different values of \(a\) and \(b\) you can generate many hash codes that are independent of each other.</p>

<h2 id="toc_2">Implementation</h2>

<pre><code class="language-python">import random


class UniversalHash:
    &quot;&quot;&quot;
    &gt;&gt;&gt; h=UniversalHash()
    &gt;&gt;&gt; h[54]=&quot;cat&quot;
    &gt;&gt;&gt; h[26]=&quot;dog&quot;
    &gt;&gt;&gt; h[93]=&quot;lion&quot;
    &gt;&gt;&gt; h[77]=&quot;bird&quot;
    &gt;&gt;&gt; h[31]=&quot;cow&quot;
    &gt;&gt;&gt; h[44]=&quot;goat&quot;
    &gt;&gt;&gt; 54 in h
    True
    &quot;&quot;&quot;
    def __init__(self):
        self.size = 100
        self.slots = [None] * self.size
        self.data = [None] * self.size
        (self.p, self.a, self.b) = self.generate_hash_constants()


    def generate_hash_constants(self):
        &quot;&quot;&quot;
        generate a, b, p for universal hashing
        &quot;&quot;&quot;
        p = self._get_prime()  # set p a  random prime number
        a = random.randint(1, p - 1)  # A has a random value between 1 and p - 1.
        b = random.randint(1, p - 1)  # B has a random value between 1 and p - 1
        return p, a, b

    def put(self, key, data):
        hash_value = self.hash_function(key)
        if self.slots[hash_value] is None:
            self.slots[hash_value] = key
            self.data[hash_value] = data
        elif self.slots[hash_value] == key:
            self.data[hash_value] = data
        else:
            # rehash
            next_slot = self.rehash(hash_value, len(self.slots))
            while self.slots[next_slot] is not None and self.slots[next_slot] != key:
                next_slot = self.rehash(hash_value, len(self.slots))

            if self.slots[next_slot] is None:
                self.slots[next_slot] = key
                self.data[hash_value] = data
            else:
                self.data[hash_value] = data

    def hash_function(self, key):
        &quot;&quot;&quot;
        hash_function implements the simple remainder method
        &quot;&quot;&quot;
        return round(self.a * key + self.b) % self.p % self.size

    def rehash(self, old_hash, size):
        &quot;&quot;&quot;
        linear probing with a plus 1
        &quot;&quot;&quot;
        return (old_hash+1) % size

    def get(self, key):
        start_slot = self.hash_function(key)
        data = None
        stop = False
        found = False
        position = start_slot
        while self.slots[position] is not None and \
                not found and not stop:
            if self.slots[position] == key:
                found = True
                data = self.data[position]
            else:
                position = self.rehash(position, len(self.slots))
            if position == start_slot:
                stop = True
        return data

    def _is_prime(self,n):
        if n &lt;= 2 or n%2 == 0:
            return False

        return not any((n%i == 0 for i in range(3, n-1)))

    def _get_prime(self, p=0):
        &quot;&quot;&quot;
        get a prime number
        &quot;&quot;&quot;
        if p == 0:
            p = random.randint(1000000,10000000)
        while not self._is_prime(p):
            p += 1

        return p

    def __getitem__(self, key):
        return self.get(key)

    def __setitem__(self, key, data):
        self.put(key, data)

    def __len__(self):
        &quot;&quot;&quot;
        return length
        &quot;&quot;&quot;
        count = 0
        for item in self.slots:
            if item is not None:
                count += 1

        return count

    def __contains__(self, item):
        &quot;&quot;&quot;
        定义了使用in和not in进行成员测试时类的行为
        &quot;&quot;&quot;
        return self.get(item) is not None

    def __iter__(self):
        &quot;&quot;&quot;
        iterator
        &quot;&quot;&quot;
        for item in self.slots:
            if item is not None:
                yield item

if __name__ == &quot;__main__&quot;:
    import doctest
    doctest.testmod(verbose=True)

</code></pre>

<h2 id="toc_3">Resources</h2>

<ol>
<li><a href="https://www.cse.iitb.ac.in/%7Esri/cs213/lec-Hashing.pdf">Hash Functions and Hash Tables</a></li>
<li>Cormen, Leiserson, Rivest, and Stein, Introduction to Algorithms (3rd edition)</li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/7/23</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Hash%20Table.html'>Hash Table</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="Hash_Table_3_A_variant_of_2_Sum_Algorithm.html">
                
                  <h1>Hash Table (3): A variant of 2-Sum Algorithm</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>The goal of the arcticle is to implement a variant of the <code>2-SUM algorithm</code>.</p>

<p>The file contains 1 million integers, both positive and negative (repetitions exists!). This is your array of integers, with the \(i\)th row of the file specifying the \(i\)th entry of the array.</p>

<p>The task is to compute the number of target values \(t\) in the interval \([-10000,10000]\)(inclusive) such that there are distinct numbers \(x,y\) in the input file that satisfy \(x+y=t\). </p>

<h2 id="toc_0">Implementation</h2>

<p>The key process lies in the <code>hash function</code>, which might be set to appropriate small value based on the origin value:<br/>
\[\text{hash_function}= \frac{\text{number}}{\text{factor}}\]</p>

<p>The <code>factor</code> is selected based on the number of <code>slots</code> needed in the algorithm. i.e.<br/>
\[\frac{\text{the range of keys}}{\text{factor}}\approx \text{the number of slots} &lt; \text{the number of keys}\]</p>

<p>There, factor is \(\frac{\text{the number of key}}{2}\)</p>

<pre><code class="language-python">class HashTable(object):

    def __init__(self):

        self.size = 5000000
        self.slots = [set() for i in range(self.size)]
        self.data = set()

    def put(self, key, data):

        hash_value = self.hash_function(key)
        self.slots[hash_value].add(data)
        self.data.add(data)

    def hash_function(self, key):

        return key//(self.size//2)

    def get(self, key):
        &quot;&quot;&quot;
        there key == data
        &quot;&quot;&quot;
        slot = self.hash_function(key)
        if key in self.slots[slot]:
            return key
        else:
            return None

    def buildfromfile(self, textfile):

        with open(text_file, &#39;r&#39;) as infile:
            for line in infile.readlines():
                self.put(int(line), int(line))

    def two_sum_count(self):
        &quot;&quot;&quot;
        Compute the number of target values t in the interval[low, high] (inclusive),
        such that there are distinct numbers x, y that satisfy x+y = t
        &quot;&quot;&quot;
        sums = set()

        for key1 in self.data:
            left = self.hash_function(-key1-10000)
            right = self.hash_function(-key1+10000)

            for slot in self.slots[left:right+1]:

                for key2 in slot:

                    if 10000 &gt; key1 + key2 &gt; -10000:
                        sums.add(key1+key2)

        return len(sums)


if __name__ == &quot;__main__&quot;:

    # target files for counting
    text_file = &#39;two_sum.txt&#39;

    hashnumber = HashTable()
    hashnumber.buildfromfile(text_file)
    print(hashnumber.two_sum_count())
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/7/23</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Hash%20Table.html'>Hash Table</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="heap_median_maintenance.html">
                
                  <h1>Heap (2): Median Maintenance</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p><strong>Problem Statement</strong>: The goal of the problem is to implement the <code>Median Maintenance</code> algorithm. The text file contains a list of the integers; you should treat this as a stream of numbers, arriving one by one. Letting \(x_i\) denote the \(i\)th number of the file, the \(k\)th median \(m_k\) is defined as the median of the numbers \(x_1,…,x_k\). (So, if \(k\) is odd, then \(m_k\) is \(((k+1)/2)\)th smallest number among \(x_1,…,x_k\); if \(k\) is even, then \(m_k\) is the \((k/2)\)th smallest number among \(x_1,…,x_k\).)</p>

<h1 id="toc_0">Solution</h1>

<p>We might use a max heap to represent elements that are less than the median, and a min heap to represent elements that are greater than the median.</p>

<p>After balancing the heaps, the number of elements in two heaps differs at most by 1. </p>

<pre><code class="language-python">Step 1: Add next item to one of the heaps

   if next item &lt; maxHeap root:
        add it to maxHeap
   else:
        add it to minHeap

Step 2: Balance the heaps (after this step heaps will be either balanced or
   one of them will contain 1 more item)

   if number of elements in one of the heaps &gt; the other by
   more than 1:
        remove the root element from the one containing more elements 
        and add to the other one

Step 3: Calculate the median:

   if the heaps contain equal amount of elements:
        median = root of maxHeap
   else:
        median = root of the heap with more elements
</code></pre>

<h2 id="toc_1">Implementation</h2>

<pre><code class="language-python">import doctest
import sys

class MinHeap(object):
    &quot;&quot;&quot;
    Min Heap
    &gt;&gt;&gt; bh = MinHeap()
    &gt;&gt;&gt; bh.buildHeap([9,5,14,18,-17,27,33,19,11,21])
    &gt;&gt;&gt; bh.findMin()
    -17
    &gt;&gt;&gt; bh.delMin()
    -17
    &gt;&gt;&gt; bh.list[1:]
    [5, 9, 14, 11, 21, 27, 33, 19, 18]
    &gt;&gt;&gt; bh.insert(-100)
    &gt;&gt;&gt; bh.delMin()
    -100
    &quot;&quot;&quot;

    def __init__(self):
        &quot;&quot;&quot;
        add self.list 0 with initialization in order to divide
        &quot;&quot;&quot;
        self.list = [-sys.maxsize]
        self.size = 0


    def insert(self, k):
        &quot;&quot;&quot;
        Insert element to the MinBinaryHeap
        &quot;&quot;&quot;
        self.list.append(k)
        self.size += 1
        self.perc_up(self.size)


    def findMin(self):
        &quot;&quot;&quot;
        Find the min element and return it
        &quot;&quot;&quot;
        return self.list[1]


    def delMin(self):
        &quot;&quot;&quot;
        Delete the min element
        and return it
        &quot;&quot;&quot;
        retrival = self.list[1]
        self.size -= 1
        self.list[1] = self.list[-1]
        self.list.pop()
        self.perc_down(1)

        return retrival


    def isEmpty(self):
        &quot;&quot;&quot;
        Return if the MinBinaryHeap is empty
        &quot;&quot;&quot;
        return self.size == 0

    def __len__(self):
        &quot;&quot;&quot;
        Magic Method: return the length of MinBinaryHeap
        &quot;&quot;&quot;
        return self.size


    def buildHeap(self, alist):
        &quot;&quot;&quot;
        Build a MinBinaryHeap from alist which is a collection of data
        &quot;&quot;&quot;
        self.list.extend(alist)
        self.size = len(alist)

        i = self.size//2
        while i &gt; 0:
            self.perc_down(i)
            i -= 1

    def perc_up(self, i):
        &quot;&quot;&quot;&quot;
        perc_up i
        &quot;&quot;&quot;
        while i//2&gt;0:
            if self.list[i] &lt; self.list[i // 2]:
                self.list[i], self.list[i // 2] = self.list[i // 2], self.list[i]
            i = i // 2

    def perc_down(self, i):
        &quot;&quot;&quot;
        perc down i
        &quot;&quot;&quot;
        while (i * 2) &lt;= self.size:
            mc = self.minChild(i)
            if self.list[i] &gt; self.list[mc]:
                self.list[i], self.list[mc] = self.list[mc], self.list[i]
            i = mc

    def minChild(self, i):
        &quot;&quot;&quot;
        find the min child
        &quot;&quot;&quot;
        if i * 2 + 1 &gt; self.size:
            return i * 2
        else:
            if self.list[i * 2] &lt; self.list[i * 2 + 1]:
                return i * 2
            else:
                return i * 2 + 1

    def __iter__(self):
        return iter(self.list[1:])


class MaxHeap(object):
    &quot;&quot;&quot;
    Max Heap
    &gt;&gt;&gt; bh = MaxHeap()
    &gt;&gt;&gt; bh.buildHeap([9,5,14,18,-17,27,33,19,11,21])
    &gt;&gt;&gt; bh.delMax()
    33
    &gt;&gt;&gt; bh.insert(100)
    &gt;&gt;&gt; bh.delMax()
    100
    &gt;&gt;&gt; len(bh)
    9
    &quot;&quot;&quot;

    def __init__(self):
        self.heap = MinHeap()

    def insert(self, k):
        self.heap.insert(-k)

    def delMax(self):
        return -self.heap.delMin()

    def buildHeap(self, alist):
        for i in range(len(alist)):
            alist[i] = -alist[i]
        self.heap.buildHeap(alist)

    def findMax(self):
        return -self.heap.findMin()

    def __len__(self):
        return self.heap.size

    def __iter__(self):
        for i in range(1, self.heap.size+1):
            yield -self.heap.list[i]


def median_maintenance(textfile):

    min_heap = MinHeap()  # &gt; medium
    max_heap = MaxHeap()  # &lt; medium

    medians = []
    count = 0

    with open(textfile) as infile:
        for line in infile:
            item = int(line)
            count += 1

            # Step 1: Add next item to one of the hepas
            # special case: initialize
            if count == 1:
                max_heap.insert(item)
            else:
                if item &lt; max_heap.findMax():
                    max_heap.insert(item)
                else:
                    min_heap.insert(item)

            # Step2: Balance the heap
            if abs(len(max_heap) - len(min_heap)) &gt; 1:
                if len(max_heap) &gt; len(min_heap):
                    min_heap.insert(max_heap.delMax())
                else:
                    max_heap.insert(min_heap.delMin())

            # Step3: calculate median
            if len(max_heap) == len(min_heap):
                median = max_heap.findMax()
            else:
                if len(max_heap) &gt; len(min_heap):
                    median = max_heap.findMax()
                else:
                    median = min_heap.findMin()

            medians.append(median)

            # test
            #for element in max_heap:
            #    print(element, end=&#39; &#39;)
            #for element in min_heap:
            #    print(element, end=&#39; &#39;)
            #print(&#39;total elem:&#39;,len(max_heap)+len(min_heap))


    return medians

if __name__ == &#39;__main__&#39;:
    # doctest.testmod(verbose=True)
    #textfile = &#39;SmallTest.txt&#39;
    textfile = &#39;Median.txt&#39;
    medians = median_maintenance(textfile)
    answer = sum(medians)%10000
    print(answer)
</code></pre>

<h2 id="toc_2">Resources</h2>

<ol>
<li><a href="https://stackoverflow.com/questions/14189540/python-topn-max-heap-use-heapq-or-self-implement">max heap implementation</a></li>
<li><a href="https://stackoverflow.com/questions/10657503/find-running-median-from-a-stream-of-integers">median maintenance</a></li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/7/21</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html'>Python数据结构与算法</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="Python数据结构与算法_1.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="Python数据结构与算法_3.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="http://or9a8nskt.bkt.clouddn.com/figure.jpeg" /></div>
            
                <h1>techlarry</h1>
                <div class="site-des">他山之石，可以攻玉</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/techlarry" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:wang.zhen.hua.larry@gmail.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Leetcode.html"><strong>Leetcode</strong></a>
        
            <a href="Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html"><strong>Python数据结构与算法</strong></a>
        
            <a href="Python%E7%89%B9%E6%80%A7.html"><strong>Python特性</strong></a>
        
            <a href="%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html"><strong>机器学习</strong></a>
        
            <a href="Python%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E4%B8%89%E7%BB%B4%E5%8F%AF%E8%A7%86%E5%8C%96.html"><strong>Python科学计算三维可视化</strong></a>
        
            <a href="English.html"><strong>English</strong></a>
        
            <a href="%20%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA.html"><strong> 理解计算机</strong></a>
        
            <a href="Deep%20Learning.html"><strong>Deep Learning</strong></a>
        
            <a href="Latex.html"><strong>Latex</strong></a>
        
            <a href="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html"><strong>操作系统</strong></a>
        
            <a href="Linux%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html"><strong>Linux 系统编程</strong></a>
        
            <a href="%E6%95%B0%E6%8D%AE%E5%BA%93.html"><strong>数据库</strong></a>
        
            <a href="Tensorflow.html"><strong>Tensorflow</strong></a>
        
            <a href="%E5%B7%A5%E4%BD%9C%E4%B8%8E%E5%AD%A6%E4%B9%A0.html"><strong>工作与学习</strong></a>
        
            <a href="Data%20Science.html"><strong>Data Science</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15088244818278.html">Machine Learning Foundations - Mathematical Foundations</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15088177470889.html">Machine Learning Foundations (8): The noise and error</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15088177317059.html">Machine Learning Foundations (7): The VC dimension</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15088176831066.html">Machine Learning Foundations (6): Theory of generalization</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="active_learning_intro.html">主动学习</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
