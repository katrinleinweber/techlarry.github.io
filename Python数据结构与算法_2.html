<!doctype html>
<html class="no-js" lang="en">

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?fdc936c9f5a3b72177541183cdeb8cb3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112743284-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-112743284-1');
</script>

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Python数据结构与算法 - techlarry
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="techlarry" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:larryim.cc ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="wiki">WIKI</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="notebook.html">NOTEBOOK</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; techlarry</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="wiki">WIKI</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        
        <li><a target="_self" href="notebook.html">NOTEBOOK</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="Leetcode.html">Leetcode</a></li>
        
            <li><a href="C/C++.html">C/C++</a></li>
        
            <li><a href="Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html">Python数据结构与算法</a></li>
        
            <li><a href="Course.html">Course</a></li>
        
            <li><a href="Python%E7%89%B9%E6%80%A7.html">Python特性</a></li>
        
            <li><a href="%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html">机器学习</a></li>
        
            <li><a href="Python%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E4%B8%89%E7%BB%B4%E5%8F%AF%E8%A7%86%E5%8C%96.html">Python科学计算三维可视化</a></li>
        
            <li><a href="English.html">English</a></li>
        
            <li><a href="Computer%20System.html">Computer System</a></li>
        
            <li><a href="Deep%20Learning.html">Deep Learning</a></li>
        
            <li><a href="Latex.html">Latex</a></li>
        
            <li><a href="Linux%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html">Linux 系统编程</a></li>
        
            <li><a href="%E6%95%B0%E6%8D%AE%E5%BA%93.html">数据库</a></li>
        
            <li><a href="Tensorflow.html">Tensorflow</a></li>
        
            <li><a href="Big%20Data.html">Big Data</a></li>
        
            <li><a href="%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB.html">文献阅读</a></li>
        
            <li><a href="Tools.html">Tools</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="disjoint_set_data_structure.html">
                
                  <h1>Disjoint-Set Data Structure</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<ul>
<li>
<a href="#toc_0">Linked-List Implementation</a>
</li>
<li>
<a href="#toc_1">Forest Implementation of Disjoint-Set</a>
</li>
<li>
<a href="#toc_2">Reference</a>
</li>
</ul>


<p>In order to keep track of the connected components of a minimum spanning tree when implementing <code>Kruskal&#39;s algorithm</code>, a disjoint-set data structure should be used.</p>

<p><code>Disjoint-set</code> data structure, also called <code>union-find</code> data structure, is a data structure that keeps track of a set of elements partitioned into a number of disjoint subsets.</p>

<p>A <code>disjoint-set</code> data structure supports following operations:</p>

<ul>
<li><code>MAKE-SET(x)</code> creates a new set whose only member is \(x\)</li>
<li><code>UNION(x,y)</code> unites the dynamic sets that contains \(x\) and \(y\), into a new set that is the union of these two sets.</li>
<li><code>FIND-SET(x)</code> returns the representative of the set containing \(x\).</li>
</ul>

<h2 id="toc_0">Linked-List Implementation</h2>

<p>Each set is represented by its own <strong>linked list</strong>. The object for each set has attributes <em>head</em>, pointing to the first object in the list, and <em>tail</em>, pointing to the last object. Each object in the linked list contains a set member, a pointer to the next object in the list, and a pointer back to the set object.</p>

<p><img src="media/15017471539381/Screen%20Shot%202017-08-03%20at%209.21.43%20PM.png" alt="Linked List implementaion"/></p>

<p><strong>Weighted-Union Heuristic</strong>: And each linked list also includes the length of the list and we always append the shorter list onto the longer.</p>

<p>Using the linked-list representation of disjoint sets and the weighted-union heuristic, a sequence of \(m\) MAKE-SET, UNION, and FIND-SET, \(n\) of which are MAKE-SET operations, takes \(O(m+n\lg n)\) time.</p>

<pre><code class="language-python">class Node:
    &quot;&quot;&quot;
    class Node for double liked list
    &quot;&quot;&quot;
    def __init__(self, elem):
        self.prev = None
        self.elem = elem
        self.next = None

    def __hash__(self):
        return hash(self.elem)

    def __eq__(self, x, y):
        return x.elem == y.elem


class LinkedList:

    def __init__(self):
        self.head = None
        self.tail = None
        self.length = 0

    def add(self, node):
        &quot;&quot;&quot;
        add element to disjoint set
        &quot;&quot;&quot;
        if self.head:
            node.prev = self
            self.tail.next = node
            self.tail = node
        else:
            self.head = node
            self.tail = node
            node.prev = self
        self.length += 1

    def __len__(self):
        return self.length

    def set_length(self, l):
        self.length = l

    def __iter__(self):
        next_node = self.head
        while next_node:
            yield next_node
            next_node = next_node.next


            

class DisjointSet:

    def __init__(self):
        self.sets = []

    def make_set(self, node):
        &quot;&quot;&quot; 
        creates a new set whose only member (and thus representative) is x.
        &quot;&quot;&quot;
        alist = LinkedList()
        alist.add(node)
        self.sets.append(alist)
        return alist

    def union(self, nodex, nodey):
        &quot;&quot;&quot;
        unites the dynamic sets that contain x and y, into a new set that is the union of these two sets.
        &quot;&quot;&quot;
        listx = self.find_set(nodex)
        listy = self.find_set(nodey)
        
        # append the shorter list onto the longer.
        if len(listx) &gt; len(listy):
            listx.tail.next = listy.head
            for y in listy:
                y.prev = listx
            listx.tail = listy.tail
            listx.set_length = len(listx) + len(listy)
            self.sets.remove(listy)
        else:
            listy.tail.next = listx.head
            for x in listx:
                x.prev = listy
            listy.tail = listx.tail
            listy.setlength = len(listx) + len(listy)
            self.sets.remove(listx)



    def find_set(self, node):
        &quot;&quot;&quot;
        returns the representative of the set containing x
        &quot;&quot;&quot;
        return node.prev

    def connected_components(self):
        for link_list in self.sets:
            print(&#39;( &#39;, end=&#39;&#39;)
            for node in link_list:
                print(node.elem, end=&#39; &#39;)
            print(&#39;) &#39;, end=&#39;&#39;)

    def __len__(self):
        return len(self.sets)

</code></pre>

<h2 id="toc_1">Forest Implementation of Disjoint-Set</h2>

<p><code>Disjoint-set forest</code>, a faster implementation of disjoint sets, uses rooted trees represent sets, with each node containing one member and each tree representing one set. In a <code>disjoint-set forest</code>, each member points only to its parents. The root of each tree contains the representative and is its own parent.</p>

<p><img src="media/15017471539381/15017663990040.png" alt="disjoint set forest"/></p>

<p><strong>Union by Rank</strong>: For each node, we maintain a <code>rank</code>, which is an upper bound on the hight of the node. We make the root with smaller rank point to the root with larger rank during a <code>Union</code> operation.</p>

<p><strong>Path Compression</strong>: When we call <code>find_set</code>, we traverse the path from a node up to its root. Instead of just returning root, we will link all the nodes in this path directly to root. </p>

<p><img src="media/15017471539381/15017663772888.png" alt="path compression"/></p>

<pre><code class="language-python">class DisjointSet:
    &quot;&quot;&quot;
    Disjoint set data structure
    &quot;&quot;&quot;

    def __init__(self):
        self.sets = []
        self.parent = {}
        self.rank = {}

    def make_set(self, node):
        &quot;&quot;&quot;
        creates a new set whose only member (and thus representative) is x.
        &quot;&quot;&quot;
        self.parent[node] = node
        self.sets.append(node)
        self.rank[node] = 0

    def union(self, x, y):
        &quot;&quot;&quot;
        unites the dynamic sets that contain x and y, into a new set that is the union of these two sets.
        &quot;&quot;&quot;
        x_root = self.find_set(x)
        y_root = self.find_set(y)
        if x_root == y_root:
            return

        if self.rank[x_root] &gt; self.rank[y_root]:
            self.parent[y_root] = x_root
        else:
            self.parent[x_root] = y_root
            if self.rank[x_root] == self.rank[y_root]:
                self.rank[y_root] = self.rank[y_root] + 1

    def find_set(self, x):
        &quot;&quot;&quot;
        returns the representative of the set containing x
        &quot;&quot;&quot;
        if self.parent[x] != x:
            self.parent[x] = self.find_set(self.parent[x])
        return self.parent[x]

</code></pre>

<h2 id="toc_2">Reference</h2>

<ol>
<li>Cormen, Leiserson, Rivest, and Stein. 2009. Introduction to Algorithms (3rd edition)</li>
<li><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-046j-design-and-analysis-of-algorithms-spring-2012/lecture-notes/MIT6_046JS12_lec16.pdf">Disjoint-set Data Structure MIT</a></li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/8/3</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html'>Python数据结构与算法</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="greedy_algorithm_a_scheduling_problem.html">
                
                  <h1>Greedy algorithm (2): A Scheduling Application</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p><strong>Problem Statement</strong>: You want to schedule jobs (processes) on a processor. Each job has properties:</p>

<ul>
<li>weight \(w_j\) (“priority”) </li>
<li>length \(l_j\)</li>
</ul>

<p>The <code>completion time</code> \(C_j\) of job \(j\) is Sum of job lengths up to and including job \(j\).</p>

<p>The goal is to <strong>Minimize weighted sum of completion times</strong>, i.e.</p>

<p>\[\sum_{j=1}^n w_j*C_j\]</p>

<h2 id="toc_0">Algorithm</h2>

<p>Order jobs by decreasing value of \(\frac{w_j}{l_j}\), i.e. jobs have larger weight and shorter length execute earlier.</p>

<h3 id="toc_1">Greedy Exchange</h3>

<p><code>Greedy Exchange</code> is one of the techniques used in proving the correctness of greedy algorithms. The idea of a greedy exchange proof is to morph a solution produced by an optimal algorithm into the solution produced by your greedy algorithm. This shows that any optimal solution is no better than the greedy solution, which proves that greedy does in fact return an optimal solution.</p>

<h3 id="toc_2">Proof</h3>

<h4 id="toc_3">Step1: label algorithm&#39;s solution and an optimal solution</h4>

<p>Let \(\sigma\) be greedy schedule, and \(\sigma^*\) be optimal schedule. </p>

<h4 id="toc_4">Step2: Compare greedy with optimal</h4>

<p>Greedy schedule \(\sigma\) is just \(1,2,3,...,n\). And if optimal schedule \(\sigma^* \ne \sigma \), then \(\exists\) consecutive jobs \(i,j\), which \(i&gt;j\).</p>

<h4 id="toc_5">Step3: Exchange</h4>

<p>Suppose we exchange order of \(i,j\) in \(\sigma\):</p>

<ul>
<li>the cost of exchange \(w_jl_j\)</li>
<li>the benefit of exchange is \(w_jl_i\)</li>
</ul>

<p>Note: <br/>
\[i &gt;j \rightarrow w_i/l_i \le wj/lj \rightarrow w_il_j \le w_jl_i \]<br/>
Exchanging \(i,j\) in \(\sigma^*\) has net benefit of \(w_jl_i-w_il_j \ge0\).</p>

<p>\(\rightarrow\) After at most \(C_n^2\) such exchanges, \(\sigma^*\) can transform into \(\sigma\)<br/>
\(\rightarrow \sigma \) at least as good as \(\sigma^*\)<br/>
 \(\rightarrow \) Greedy is optimal.</p>

<h2 id="toc_6">Implemenation</h2>

<pre><code class="language-python">import numpy as np
import unittest

class JobSchedule:
    &quot;&quot;&quot;
    greedy algorithm that schedules jobs in decreasing order of ratio (weight/length)
    &quot;&quot;&quot;
    def __init__(self):
        self.job_num = 0 # the number of jobs
        self.job_weight = []
        self.job_length = []
        self.schedule_time = None
        self.order = None # the ordering of jobs

    def buildjobs(self, textfile):
        &quot;&quot;&quot;
        build jobs from a text file

        The file describes a set of jobs with positive and integral weights and lengths.
        It has the format
        [number_of_jobs]
        [job_1_weight] [job_1_length]

        &quot;&quot;&quot;
        count = 0
        with open(textfile) as infile:
            for line in infile.readlines():
                line = line.strip(&#39;\n&#39;)
                if count == 0:
                    self.job_num = int(line)
                else:
                    job_weight, job_length = (int(num) for num in line.split())
                    self.job_weight.append(job_weight)
                    self.job_length.append(job_length)
                count += 1

        if count-1 != self.job_num:
            raise ValueError

    def scheduling(self):
        &quot;&quot;&quot;
        return the sum of weighted completion times of the resulting schedule
        &quot;&quot;&quot;
        # ratios of weight and length for every job
        ratios = [self.job_weight[i]/self.job_length[i] for i in range(self.job_num)]
        self.order = np.lexsort((self.job_length, ratios))
        self.order=self.order[::-1]
        print([ (self.job_weight[i], self.job_length[i],self.job_weight[i]/self.job_length[i]) for i in self.order])
        # calculating the sum of weighted completion times of the resulting schedule
        count = 0
        job_length = 0
        for job_ind in self.order:
            job_length = job_length + self.job_length[job_ind]
            count += self.job_weight[job_ind]*job_length
        self.schedule_time = count
        return self.schedule_time


class TestJobSchedule(unittest.TestCase):

    def testcase1(self):
        jobs_to_schedule = JobSchedule()
        jobs_to_schedule.buildjobs(&#39;testcase1.txt&#39;)
        assert jobs_to_schedule.scheduling() == 16

    def testcase2(self):
        jobs_to_schedule = JobSchedule()
        jobs_to_schedule.buildjobs(&#39;testcase2.txt&#39;)
        assert jobs_to_schedule.scheduling() == 67247


if __name__ == &quot;__main__&quot;:
    unittest.main()
</code></pre>

<h2 id="toc_7">References</h2>

<ol>
<li><a href="http://www.cs.cornell.edu/courses/cs482/2003su/handouts/greedy_exchange.pdf">Greedy exchange</a></li>
<li><a href="https://www.coursera.org/learn/algorithms-greedy/">Algorithms Specialization</a></li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/8/1</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Greedy.html'>Greedy</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="greedy_algorithm_introduction.html">
                
                  <h1>Greedy algorithm (1): Introduction</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<ul>
<li>
<a href="#toc_0">Definition</a>
</li>
<li>
<a href="#toc_1">Contrast with Divide &amp; Conquer</a>
</li>
</ul>
</li>
<li>
<a href="#toc_2">Examples</a>
<ul>
<li>
<a href="#toc_3">The Optimal Caching Algorithm</a>
</li>
<li>
<a href="#toc_4">A Scheduling Problem</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">Reference</a>


<h3 id="toc_0">Definition</h3>

<p>A <code>greedy algorithm</code> always makes the choice that looks best at the moment. That is, it makes a locally optimal choice in the hope that this choice will lead to a globally optimal solution. (Cormen et al., 2009)</p>

<h3 id="toc_1">Contrast with Divide &amp; Conquer</h3>

<ol>
<li>Easy to propose multiple greedy algorithms for many problems. </li>
<li>Easy running time analysis. (Contrast with Master method etc.)</li>
<li>Hard to establish correctness.
(Contrast with straightforward inductive correctness proofs.)</li>
</ol>

<p><strong>DANGER: Most greedy algorithms are NOT correct. (Even if your intuition says otherwise!)</strong></p>

<h2 id="toc_2">Examples</h2>

<h3 id="toc_3">The Optimal Caching Algorithm</h3>

<p>Theorem: [Bélády&#39;s 1960s] <code>Farthest-in-Future</code> is the optimal algorithm that minimizes the number of cache misses.</p>

<p><code>Bélády&#39;s Algorithm</code>:</p>

<p>When \(d_i\) is requested but not in the cache,<br/>
evict the cache item that will next be used farthest into the future.</p>

<h3 id="toc_4">A Scheduling Problem</h3>

<p>Assume: Each job has a:</p>

<ul>
<li>weight \(w_j\) (“priority”) </li>
<li>length \(l_j\)</li>
</ul>

<p>The completion time \(C_j\) of job \(j\) = Sum of job lengths up to and including \(j\).</p>

<p>Goal: Minimize the weighted sum of completion times: \(\min \sum ^n_j= w_jC_j\)</p>

<h2 id="toc_5">Reference</h2>

<ol>
<li>Cormen, Leiserson, Rivest, and Stein. 2009. Introduction to Algorithms (3rd edition)</li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/7/31</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Greedy.html'>Greedy</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="Hash_Table_4_Universal_Hashing.html">
                
                  <h1>Hash Table (4): Universal Hashing</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>Let \(H\) be a finite collection of hash functions that map a given universe \(U\) of keys into the range \(\{0,1,...,m-1\}\). Such a collection is said to be <code>universal</code> if for each pair of distinct keys \(k,l \in U\), the number of <code>hash function</code> \(h \in H\) for which \(h(k) = h(l)\) is at most \(\frac{|H|}{m}\), i.e.</p>

<p>\[ \forall k,l \in U, k\ne l: \Pr_{h\in H }[h(x)=h(y)]\le \frac{1}{m}  \]</p>

<h2 id="toc_0">Why Universal Hashing?</h2>

<p>Some malicious adversary might chooses the keys which all hash to the same slot, yielding an average retrieval time of \(\Theta(n)\). Instead of fixed hash functions, randomly chosen hash functions can yield good performance on average.</p>

<h2 id="toc_1">Designing a universal class of hash functions</h2>

<p>In short, you can generate family of hash functions using following simple equation:</p>

<pre><code class="language-python">h(x,a,b) = ((ax+b) mod p) mod m
</code></pre>

<p>\(x\) is key you want to hash<br/>
\(a\) is any number you can choose between \(1\) to \(p-1\) inclusive.<br/>
\(b\) is any number you can choose between \(0\) to \(p-1\) inclusive.<br/>
\(p\) is a prime number that is greater than max possible value of \(x\)<br/>
\(m\) is a max possible value you want for hash code + 1<br/>
By selecting different values of \(a\) and \(b\) you can generate many hash codes that are independent of each other.</p>

<h2 id="toc_2">Implementation</h2>

<pre><code class="language-python">import random


class UniversalHash:
    &quot;&quot;&quot;
    &gt;&gt;&gt; h=UniversalHash()
    &gt;&gt;&gt; h[54]=&quot;cat&quot;
    &gt;&gt;&gt; h[26]=&quot;dog&quot;
    &gt;&gt;&gt; h[93]=&quot;lion&quot;
    &gt;&gt;&gt; h[77]=&quot;bird&quot;
    &gt;&gt;&gt; h[31]=&quot;cow&quot;
    &gt;&gt;&gt; h[44]=&quot;goat&quot;
    &gt;&gt;&gt; 54 in h
    True
    &quot;&quot;&quot;
    def __init__(self):
        self.size = 100
        self.slots = [None] * self.size
        self.data = [None] * self.size
        (self.p, self.a, self.b) = self.generate_hash_constants()


    def generate_hash_constants(self):
        &quot;&quot;&quot;
        generate a, b, p for universal hashing
        &quot;&quot;&quot;
        p = self._get_prime()  # set p a  random prime number
        a = random.randint(1, p - 1)  # A has a random value between 1 and p - 1.
        b = random.randint(1, p - 1)  # B has a random value between 1 and p - 1
        return p, a, b

    def put(self, key, data):
        hash_value = self.hash_function(key)
        if self.slots[hash_value] is None:
            self.slots[hash_value] = key
            self.data[hash_value] = data
        elif self.slots[hash_value] == key:
            self.data[hash_value] = data
        else:
            # rehash
            next_slot = self.rehash(hash_value, len(self.slots))
            while self.slots[next_slot] is not None and self.slots[next_slot] != key:
                next_slot = self.rehash(hash_value, len(self.slots))

            if self.slots[next_slot] is None:
                self.slots[next_slot] = key
                self.data[hash_value] = data
            else:
                self.data[hash_value] = data

    def hash_function(self, key):
        &quot;&quot;&quot;
        hash_function implements the simple remainder method
        &quot;&quot;&quot;
        return round(self.a * key + self.b) % self.p % self.size

    def rehash(self, old_hash, size):
        &quot;&quot;&quot;
        linear probing with a plus 1
        &quot;&quot;&quot;
        return (old_hash+1) % size

    def get(self, key):
        start_slot = self.hash_function(key)
        data = None
        stop = False
        found = False
        position = start_slot
        while self.slots[position] is not None and \
                not found and not stop:
            if self.slots[position] == key:
                found = True
                data = self.data[position]
            else:
                position = self.rehash(position, len(self.slots))
            if position == start_slot:
                stop = True
        return data

    def _is_prime(self,n):
        if n &lt;= 2 or n%2 == 0:
            return False

        return not any((n%i == 0 for i in range(3, n-1)))

    def _get_prime(self, p=0):
        &quot;&quot;&quot;
        get a prime number
        &quot;&quot;&quot;
        if p == 0:
            p = random.randint(1000000,10000000)
        while not self._is_prime(p):
            p += 1

        return p

    def __getitem__(self, key):
        return self.get(key)

    def __setitem__(self, key, data):
        self.put(key, data)

    def __len__(self):
        &quot;&quot;&quot;
        return length
        &quot;&quot;&quot;
        count = 0
        for item in self.slots:
            if item is not None:
                count += 1

        return count

    def __contains__(self, item):
        &quot;&quot;&quot;
        定义了使用in和not in进行成员测试时类的行为
        &quot;&quot;&quot;
        return self.get(item) is not None

    def __iter__(self):
        &quot;&quot;&quot;
        iterator
        &quot;&quot;&quot;
        for item in self.slots:
            if item is not None:
                yield item

if __name__ == &quot;__main__&quot;:
    import doctest
    doctest.testmod(verbose=True)

</code></pre>

<h2 id="toc_3">Resources</h2>

<ol>
<li><a href="https://www.cse.iitb.ac.in/%7Esri/cs213/lec-Hashing.pdf">Hash Functions and Hash Tables</a></li>
<li>Cormen, Leiserson, Rivest, and Stein, Introduction to Algorithms (3rd edition)</li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/7/23</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Hash%20Table.html'>Hash Table</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="Hash_Table_3_A_variant_of_2_Sum_Algorithm.html">
                
                  <h1>Hash Table (3): A variant of 2-Sum Algorithm</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>The goal of the arcticle is to implement a variant of the <code>2-SUM algorithm</code>.</p>

<p>The file contains 1 million integers, both positive and negative (repetitions exists!). This is your array of integers, with the \(i\)th row of the file specifying the \(i\)th entry of the array.</p>

<p>The task is to compute the number of target values \(t\) in the interval \([-10000,10000]\)(inclusive) such that there are distinct numbers \(x,y\) in the input file that satisfy \(x+y=t\). </p>

<h2 id="toc_0">Implementation</h2>

<p>The key process lies in the <code>hash function</code>, which might be set to appropriate small value based on the origin value:<br/>
\[\text{hash_function}= \frac{\text{number}}{\text{factor}}\]</p>

<p>The <code>factor</code> is selected based on the number of <code>slots</code> needed in the algorithm. i.e.<br/>
\[\frac{\text{the range of keys}}{\text{factor}}\approx \text{the number of slots} &lt; \text{the number of keys}\]</p>

<p>There, factor is \(\frac{\text{the number of key}}{2}\)</p>

<pre><code class="language-python">class HashTable(object):

    def __init__(self):

        self.size = 5000000
        self.slots = [set() for i in range(self.size)]
        self.data = set()

    def put(self, key, data):

        hash_value = self.hash_function(key)
        self.slots[hash_value].add(data)
        self.data.add(data)

    def hash_function(self, key):

        return key//(self.size//2)

    def get(self, key):
        &quot;&quot;&quot;
        there key == data
        &quot;&quot;&quot;
        slot = self.hash_function(key)
        if key in self.slots[slot]:
            return key
        else:
            return None

    def buildfromfile(self, textfile):

        with open(text_file, &#39;r&#39;) as infile:
            for line in infile.readlines():
                self.put(int(line), int(line))

    def two_sum_count(self):
        &quot;&quot;&quot;
        Compute the number of target values t in the interval[low, high] (inclusive),
        such that there are distinct numbers x, y that satisfy x+y = t
        &quot;&quot;&quot;
        sums = set()

        for key1 in self.data:
            left = self.hash_function(-key1-10000)
            right = self.hash_function(-key1+10000)

            for slot in self.slots[left:right+1]:

                for key2 in slot:

                    if 10000 &gt; key1 + key2 &gt; -10000:
                        sums.add(key1+key2)

        return len(sums)


if __name__ == &quot;__main__&quot;:

    # target files for counting
    text_file = &#39;two_sum.txt&#39;

    hashnumber = HashTable()
    hashnumber.buildfromfile(text_file)
    print(hashnumber.two_sum_count())
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/7/23</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Hash%20Table.html'>Hash Table</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="Python数据结构与算法_1.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="Python数据结构与算法_3.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="http://or9a8nskt.bkt.clouddn.com/figure.jpeg" /></div>
            
                <h1>techlarry</h1>
                <div class="site-des">他山之石，可以攻玉</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/techlarry" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:wang.zhen.hua.larry@gmail.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Leetcode.html"><strong>Leetcode</strong></a>
        
            <a href="C/C++.html"><strong>C/C++</strong></a>
        
            <a href="Python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.html"><strong>Python数据结构与算法</strong></a>
        
            <a href="Course.html"><strong>Course</strong></a>
        
            <a href="Python%E7%89%B9%E6%80%A7.html"><strong>Python特性</strong></a>
        
            <a href="%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html"><strong>机器学习</strong></a>
        
            <a href="Python%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E4%B8%89%E7%BB%B4%E5%8F%AF%E8%A7%86%E5%8C%96.html"><strong>Python科学计算三维可视化</strong></a>
        
            <a href="English.html"><strong>English</strong></a>
        
            <a href="Computer%20System.html"><strong>Computer System</strong></a>
        
            <a href="Deep%20Learning.html"><strong>Deep Learning</strong></a>
        
            <a href="Latex.html"><strong>Latex</strong></a>
        
            <a href="Linux%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html"><strong>Linux 系统编程</strong></a>
        
            <a href="%E6%95%B0%E6%8D%AE%E5%BA%93.html"><strong>数据库</strong></a>
        
            <a href="Tensorflow.html"><strong>Tensorflow</strong></a>
        
            <a href="Big%20Data.html"><strong>Big Data</strong></a>
        
            <a href="%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB.html"><strong>文献阅读</strong></a>
        
            <a href="Tools.html"><strong>Tools</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="virtual_memory_and_dynamic_allocate.html">虚拟内存和动态内存分配</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="Sync.html">同步/异步</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="Signal.html">信号</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="Linking.html">链接</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="python_assembly_code.html">Python汇编代码</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
